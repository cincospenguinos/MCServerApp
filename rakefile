require 'rake'
require 'fileutils'
require 'yaml'

require 'rake/testtask'

# TODO: Testing
# Rake::TestTask.new do |t|
#   t.libs << 'test'
# end

task :setup do
  FileUtils.makedirs('config') unless File.directory?('config')
  config_flag = false

  Dir.chdir('config') do

    # Setup db_config
    unless File.exist?('db_config.yml')
      db_config = {
          production: {
              db_schema_name: '',
              db_username: '',
              db_password: '',
              db_hostname: '',
              db_engine: ''
          },
          development: {
              db_schema_name: '',
              db_username: '',
              db_password: '',
              db_hostname: '',
              db_engine: ''
          },
          test: {
              db_schema_name: '',
              db_username: '',
              db_password: '',
              db_hostname: '',
              db_engine: ''
          }
      }.to_yaml
      File.open('db_config.yml', 'w') {|f| f.write(db_config) }
      puts 'Please modify the db_config.yml file'
      config_flag = true
    end

    # Setup the startup script config
    unless File.exist?('startup_script_config.yml')
      startup_config = {
          full_file_path: '',
          status: 'status',
          start: 'start',
          stop: 'stop'
      }.to_yaml
      File.open('startup_script_config.yml', 'w') { |f| f.write(startup_config)}
      puts 'Please modify the startup_script_config.yml file'
      config_flag = true
    end

    unless File.exist?('email_config.yml')
      email_config = {
          email_address: '',
          password: '',
          admin_email_address: ''
      }.to_yaml
      File.open('email_config.yml', 'w') { |f| f.write(email_config) }
      puts 'Please modify email_config.yml'
      config_flag = true
    end
  end

  exit 1 if config_flag
end

# TODO: What should this be?
task :default => [:setup] do

end